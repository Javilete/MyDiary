$(document).ready(function(){function e(){var e=localStorage.getItem("data");if(e){e=JSON.parse(e);var t=$("#posts");t.empty(),$.each(e,function(e,o){var a="<li></li>",n='<article class="entry"></article>',i='<div class="entry"></div>',r="<h2></h2>",c='<img src="images/remove.png"></img>',s='<span class="location"></span>',l="<p></p>",d=$(a),u=$(n),p=($(r),$(i));$(r).text(o.subject).appendTo(p),$(c).appendTo(p),$(s).text(o.location).appendTo(p),p.appendTo(u),$(l).text(o.body).appendTo(u),u.appendTo(d),d.appendTo(t)})}else{e=JSON.parse(i);var t=$("#posts");t.empty(),$.each(e,function(e,o){var a='<article class="entry default"></article>',n="<h2></h2>",i="<p></p>",r=$(a);$(n).text(o.subject).appendTo(r),$(i).text(o.body).appendTo(r),r.appendTo(t)})}}function t(){var t=$("#addTextForm input").val();if(!t)return void alert("Subject is required");var n=$("#addTextForm textarea").val();if(!n)return void alert("Body is required");var i=$("#geoLocation").text();o(t,n,i),a(),e()}function o(e,t,o){console.log("Adding an entry");var a;if(null!=localStorage.getItem("data")){var n=localStorage.getItem("data");a=JSON.parse(n)}else a=[];var i={};i.location=o,i.subject=e,i.body=t,a.unshift(i),localStorage.setItem("data",JSON.stringify(a))}function a(){$("#addTextForm input").val(""),$("#addTextForm textarea").val(""),$("#form").hide()}function n(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){console.log(e);var t=moment().format("MMM Do YYYY, hh:mm:ss a"),o=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),a=new google.maps.Geocoder;return a.geocode({latLng:o},function(e,o){if("OK"!==o)throw"Geocoder failed due to: "+o;var a=e[0].address_components[4].short_name;$("#geoLocation").text("at "+a+" on "+t)})},function(e){switch(e.code){case e.PERMISSION_DENIED:throw"User denied the request for Geolocation.";case e.POSITION_UNAVAILABLE:throw"Location information is unavailable.";case e.TIMEOUT:throw"The request to get user location timed out.";case e.UNKNOWN_ERROR:throw"An unknown error occurred."}},{maximumAge:0})}var i='[{"subject": "Welcome to my Diary!!!","body": "There are currently no entries in this diary, but go ahead and add one â€” it will be AWESOME!!!"}]';$("section").on("click","div",function(){$(this).toggleClass("selected"),$(this).next("p").slideToggle(300)}),$("a").click(function(){$("#form").show(),n(),$("input").focus()}),$("#submit").click(function(){t(),$("#form").hide()}),$("#cancel").click(function(){$("a").show(),$("#form").hide()}),$("section").on("click","img",function(){var e=$(this).parents("li"),t=localStorage.getItem("data"),o=JSON.parse(t);console.log(e.index()),o.splice(e.index(),1),e.remove(),localStorage.setItem("data",JSON.stringify(o))}),$(e())});